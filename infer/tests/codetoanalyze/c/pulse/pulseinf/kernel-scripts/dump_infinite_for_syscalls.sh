#!/bin/bash

# Change this for your home folder where infer was built
INFER_HOME=/huge/jvanegue/PUBLIC_GITHUB/infer

syslist='32_ftruncate64\|32_llseek\|32_personality\|32_pread\|32_pwrite\|32_sigaction\|32_truncate64\|64_mremap\|64_munmap\|aarch32_fadvise64_64\|aarch32_fallocate\|aarch32_fstatfs64\|aarch32_ftruncate64\|aarch32_mmap2\|aarch32_pread64\|aarch32_pwrite64\|aarch32_readahead\|aarch32_statfs64\|aarch32_sync_file_range2\|aarch32_truncate64\|accept\|accept4\|access\|acct\|add_key\|adjtimex\|adjtimex_time32\|alarm\|alpha_pipe\|arc_gettls\|arch_prctl\|arc_settls\|arc_usr_cmpxchg\|arm64_personality\|bind\|bpf\|brk\|cachectl\|cacheflush\|capget\|capset\|chdir\|chmod\|chown\|chown16\|chroot\|clock_adjtime\|clock_adjtime32\|clock_getres\|clock_getres_time32\|clock_gettime\|clock_gettime32\|clock_nanosleep\|clock_nanosleep_time32\|clock_settime\|clock_settime32\|clone\|clone3\|close\|close_range\|connect\|copy_file_range\|creat\|csky_fadvise64_64\|debug_setcontext\|delete_module\|dup\|dup2\|dup3\|epoll_create\|epoll_create1\|epoll_ctl\|epoll_pwait\|epoll_pwait2\|epoll_wait\|eventfd\|eventfd2\|execve\|execveat\|exit\|exit_group\|faccessat\|faccessat2\|fadvise64\|fadvise64_64\|fallocate\|fanotify_init\|fanotify_mark\|fchdir\|fchmod\|fchmodat\|fchown\|fchown16\|fchownat\|fcntl\|fcntl64\|fdatasync\|fgetxattr\|finit_module\|flistxattr\|flock\|fork\|fremovexattr\|fsconfig\|fsetxattr\|fsmount\|fsopen\|fspick\|fstat\|fstat64\|fstatat64\|fstatfs\|fstatfs64\|fsync\|ftruncate\|ftruncate64\|futex\|futex_time32\|futex_waitv\|futimesat\|futimesat_time32\|getcpu\|getcwd\|getdents\|getdents64\|getdomainname\|getdtablesize\|getegid\|getegid16\|geteuid\|geteuid16\|getgid\|getgid16\|getgroups\|getgroups16\|gethostname\|getitimer\|get_mempolicy\|getpagesize\|getpeername\|getpgid\|getpgrp\|getpid\|getppid\|getpriority\|getrandom\|getresgid\|getresgid16\|getresuid\|getresuid16\|getrlimit\|get_robust_list\|getrusage\|getsid\|getsockname\|getsockopt\|get_thread_area\|gettid\|gettimeofday\|getuid\|getuid16\|getxattr\|getxgid\|getxpid\|getxuid\|ia32_clone\|ia32_fadvise64\|ia32_fadvise64_64\|ia32_fallocate\|ia32_fstat64\|ia32_fstatat64\|ia32_ftruncate64\|ia32_lstat64\|ia32_mmap\|ia32_pread64\|ia32_pwrite64\|ia32_readahead\|ia32_stat64\|ia32_sync_file_range\|ia32_truncate64\|init_module\|inotify_add_watch\|inotify_init\|inotify_init1\|inotify_rm_watch\|io_cancel\|ioctl\|io_destroy\|io_getevents\|io_getevents_time32\|ioperm\|io_pgetevents\|io_pgetevents_time32\|io_pgetevents_time64\|iopl\|ioprio_get\|ioprio_set\|io_setup\|io_submit\|io_uring_enter\|io_uring_register\|io_uring_setup\|ipc\|kcmp\|kern_features\|kexec_file_load\|kexec_load\|keyctl\|kill\|landlock_add_rule\|landlock_create_ruleset\|landlock_restrict_self\|lchown\|lchown16\|lgetxattr\|link\|linkat\|listen\|listxattr\|llistxattr\|llseek\|lremovexattr\|lseek\|lsetxattr\|lstat\|lstat64\|madvise\|mbind\|membarrier\|memfd_create\|memfd_secret\|memory_ordering\|migrate_pages\|mincore\|mips_mmap\|mips_mmap2\|mkdir\|mkdirat\|mknod\|mknodat\|mlock\|mlock2\|mlockall\|mmap\|mmap2\|mmap_pgoff\|modify_ldt\|mount\|mount_setattr\|move_mount\|move_pages\|mprotect\|mq_getsetattr\|mq_notify\|mq_open\|mq_timedreceive\|mq_timedreceive_time32\|mq_timedsend\|mq_timedsend_time32\|mq_unlink\|mremap\|msgctl\|msgget\|msgrcv\|msgsnd\|msync\|munlock\|munlockall\|munmap\|name_to_handle_at\|nanosleep\|nanosleep_time32\|newfstat\|newfstatat\|newlstat\|newstat\|newuname\|nice\|nis_syscall\|ni_syscall\|old_adjtimex\|old_getrlimit\|old_mmap\|old_msgctl\|old_readdir\|old_select\|old_semctl\|old_shmctl\|oldumount\|olduname\|open\|openat\|openat2\|open_by_handle_at\|open_tree\|osf_brk\|osf_fstat\|osf_fstatfs\|osf_fstatfs64\|osf_getdirentries\|osf_getdomainname\|osf_getpriority\|osf_getrusage\|osf_getsysinfo\|osf_gettimeofday\|osf_lstat\|osf_mmap\|osf_mount\|osf_proplist_syscall\|osf_readv\|osf_select\|osf_set_program_attributes\|osf_setsysinfo\|osf_settimeofday\|osf_sigaction\|osf_sigprocmask\|osf_sigstack\|osf_stat\|osf_statfs\|osf_statfs64\|osf_sysinfo\|osf_usleep_thread\|osf_utimes\|osf_utsname\|osf_wait4\|osf_writev\|pause\|pciconfig_iobase\|pciconfig_read\|pciconfig_write\|perf_event_open\|personality\|pidfd_getfd\|pidfd_open\|pidfd_send_signal\|pipe\|pipe2\|pivot_root\|pkey_alloc\|pkey_free\|pkey_mprotect\|poll\|ppoll\|ppoll_time32\|ppoll_time64\|prctl\|pread64\|preadv\|preadv2\|preadv64\|preadv64v2\|prlimit64\|process_madvise\|process_mrelease\|process_vm_readv\|process_vm_writev\|pselect6\|pselect6_time32\|pselect6_time64\|ptrace\|pwrite64\|pwritev\|pwritev2\|pwritev64\|pwritev64v2\|quotactl\|quotactl_fd\|read\|readahead\|readlink\|readlinkat\|readv\|reboot\|recv\|recvfrom\|recvmmsg\|recvmmsg_time32\|recvmmsg_time64\|recvmsg\|remap_file_pages\|removexattr\|rename\|renameat\|renameat2\|request_key\|restart_syscall\|riscv_flush_icache\|rmdir\|rseq\|rtas\|rt_sigaction\|rt_sigpending\|rt_sigprocmask\|rt_sigqueueinfo\|rt_sigreturn\|rt_sigsuspend\|rt_sigtimedwait\|rt_sigtimedwait_time32\|rt_sigtimedwait_time64\|rt_tgsigqueueinfo\|s390_fadvise64\|s390_fadvise64_64\|s390_fallocate\|s390_fstat64\|s390_fstatat64\|s390_ftruncate64\|s390_guarded_storage\|s390_ipc\|s390_lstat64\|s390_mmap2\|s390_old_mmap\|s390_pci_mmio_read\|s390_pci_mmio_write\|s390_personality\|s390_pread64\|s390_pwrite64\|s390_read\|s390_readahead\|s390_runtime_instr\|s390_stat64\|s390_sthyi\|s390_sync_file_range\|s390_truncate64\|s390_write\|sched_getaffinity\|sched_getattr\|sched_getparam\|sched_get_priority_max\|sched_get_priority_min\|sched_getscheduler\|sched_rr_get_interval\|sched_rr_get_interval_time32\|sched_setaffinity\|sched_setattr\|sched_setparam\|sched_setscheduler\|sched_yield\|seccomp\|select\|semctl\|semget\|semop\|semtimedop\|semtimedop_time32\|send\|sendfile\|sendfile64\|sendmmsg\|sendmsg\|sendto\|setdomainname\|setfsgid\|setfsgid16\|setfsuid\|setfsuid16\|setgid\|setgid16\|setgroups\|setgroups16\|sethae\|sethostname\|setitimer\|set_mempolicy\|set_mempolicy_home_node\|setns\|setpgid\|setpriority\|setregid\|setregid16\|setresgid\|setresgid16\|setresuid\|setresuid16\|setreuid\|setreuid16\|setrlimit\|set_robust_list\|setsid\|setsockopt\|set_thread_area\|set_tid_address\|settimeofday\|setuid\|setuid16\|setxattr\|sgetmask\|shmat\|shmctl\|shmdt\|shmget\|shutdown\|sigaction\|sigaltstack\|sigaltstackconst\|signal\|signalfd\|signalfd4\|sigpending\|sigprocmask\|sigreturn\|sigsuspend\|socket\|socketcall\|socketpair\|sparc64_personality\|sparc_adjtimex\|sparc_clock_adjtime\|sparc_ipc\|sparc_pipe\|sparc_remap_file_pages\|sparc_sigaction\|splice\|spu_create\|spu_runint\|ssetmask\|stat\|stat64\|statfs\|statfs64\|statx\|stime\|stime32\|subpage_prot\|swapcontext\|swapoff\|swapon\|switch_endian\|symlink\|symlinkat\|sync\|sync_file_range\|sync_file_range2\|syncfs\|sysfs\|sysinfo\|syslog\|sysmips\|tee\|tgkill\|time\|time32\|timer_create\|timer_delete\|timerfd_create\|timerfd_gettime\|timerfd_gettime32\|timerfd_settime\|timerfd_settime32\|timer_getoverrun\|timer_gettime\|timer_gettime32\|timer_settime\|timer_settime32\|times\|tkill\|truncate\|truncate64\|umask\|umount\|uname\|unlink\|unlinkat\|unshare\|uselib\|userfaultfd\|ustat\|utime\|utime32\|utimensat\|utimensat_time32\|utimes\|utimes_time32\|utrap_install\|vfork\|vhangup\|vm86\|vm86old\|vmsplice\|wait4\|waitid\|waitpid\|write\|writev\|x32_rt_sigreturn'


for i in $(seq 10000); do
    $INFER_HOME/infer/bin/infer-debug --procedures --procedures-summary --procedures-filter $syslist --select $i > bug$i.log
    out=(cat bug$i.log)
    if echo $out | grep -q InfiniteProgram; then
	echo Infinite Loop error found for syscall procedure number $i see infinite-bug-$i.log
	mv bug$i.log infinite-bug-$i.log
    fi;
done
